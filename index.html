<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nickoasplays - Projetos</title>
    <style>
        /* Variáveis para Tema Escuro (Padrão) */
        :root {
            --bg-color: #000536;
            --header-gradient: radial-gradient(circle at top right, #00106b, transparent), radial-gradient(circle at bottom left, #00021a, transparent);
            --btn-color: #6493a1;
            --btn-hover: #ffffff;
            --text-primary: #99f8ff;
            --text-secondary: #ffffff;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(173, 245, 255, 0.1);
        }

        /* Adaptação para Tema Claro do Sistema */
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f0f4f8;
                --header-gradient: radial-gradient(circle at top right, #dbeafe, transparent);
                --btn-color: #4a7481;
                --btn-hover: #000000;
                --text-primary: #005a6e;
                --text-secondary: #1a202c;
                --card-bg: rgba(255, 255, 255, 0.8);
                --card-border: rgba(0, 0, 0, 0.1);
            }
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }

        body {
            background-color: var(--bg-color);
            background-image: var(--header-gradient);
            color: var(--text-secondary);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header { text-align: center; margin-bottom: 40px; }
        h1 { color: var(--text-primary); font-size: 2.5rem; margin: 0; }
        .subtitle { opacity: 0.8; font-size: 1.1rem; margin-top: 5px; }

        #lista-projetos {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .projeto-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            position: relative;
            backdrop-filter: blur(5px);
        }

        .projeto-card:hover {
            border-color: var(--btn-color);
            transform: translateY(-2px);
        }

        .projeto-titulo { 
            color: var(--text-primary); 
            font-size: 1.15rem; 
            margin: 0; 
            padding-right: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .projeto-titulo::after {
            content: '▲';
            font-size: 0.7rem;
            transform: rotate(180deg);
            opacity: 0.5;
            transition: transform 0.3s;
        }

        .projeto-card.aberto .projeto-titulo::after { transform: rotate(0deg); }

        .projeto-conteudo {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .projeto-card.aberto .projeto-conteudo {
            max-height: 2000px;
            opacity: 1;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(128,128,128,0.2);
        }

        .projeto-desc { 
            font-size: 0.95rem; 
            line-height: 1.5; 
            margin-bottom: 5px; 
            white-space: pre-wrap; 
        }

        .download-btn {
            background-color: var(--btn-color);
            color: #fff;
            padding: 4px 12px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.8rem;
            margin: 5px 0;
            border: none;
            line-height: 1.2;
            cursor: pointer;
        }

        @media (prefers-color-scheme: light) {
            .download-btn { color: #fff; }
        }

        .download-btn:hover { 
            background-color: var(--btn-hover);
            color: var(--bg-color);
        }

        .error-msg { color: #ff6b6b; text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <header>
        <h1>Nickoasplays</h1>
        <p class="subtitle">Meus projetinhos!</p>
    </header>

    <div id="lista-projetos">
        <p style="text-align: center;">Buscando projetos...</p>
    </div>

    <script>
        const GITHUB_USER = 'Nickoasplays'; 
        const GITHUB_REPO = 'blog';

        async function forceDownload(url, filename) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(blobUrl);
                a.remove();
            } catch (e) {
                window.open(url, '_blank');
            }
        }

        async function fetchWithRetry(url, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (response.ok) return response;
                } catch (e) {
                    if (i === retries - 1) throw e;
                    await new Promise(res => setTimeout(res, 800));
                }
            }
            return null;
        }

        async function getRawContent(path) {
            const cb = `?t=${Date.now()}`;
            const res = await fetchWithRetry(`https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/${path}${cb}`);
            return res ? await res.text() : null;
        }

        async function getFolderContents(path) {
            const res = await fetchWithRetry(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${path}`);
            return res ? await res.json() : [];
        }

        async function init() {
            const container = document.getElementById('lista-projetos');
            
            try {
                const blogTxt = await getRawContent('blog.txt');
                if (!blogTxt) throw new Error("Não foi possível carregar a lista de projetos.");
                
                const pastas = blogTxt.split('\n').map(p => p.trim()).filter(p => p);
                container.innerHTML = "";

                for (let pasta of pastas) {
                    const infoTxt = await getRawContent(`${pasta}/info.txt`);
                    if (!infoTxt) continue;

                    const lines = infoTxt.split('\n');
                    const titulo = lines[0].trim();
                    let desc = lines.slice(1).join('\n').trim();
                    
                    const arquivos = await getFolderContents(`${pasta}/download`);
                    let btnHtml = "";

                    if (Array.isArray(arquivos) && arquivos.length > 0) {
                        const file = arquivos.find(f => f.type === 'file');
                        if (file) {
                            btnHtml = `
                                <button class="download-btn" onclick="event.stopPropagation(); forceDownload('${file.download_url}', '${file.name}')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                    Baixar arquivos
                                </button>`;
                        }
                    }

                    const conteudoFinal = desc.includes("[download]") 
                        ? desc.replace("[download]", btnHtml) 
                        : desc + (btnHtml ? "<br>" + btnHtml : "");

                    const card = document.createElement('div');
                    card.className = 'projeto-card';
                    card.innerHTML = `
                        <h2 class="projeto-titulo">${titulo}</h2>
                        <div class="projeto-conteudo">
                            <div class="projeto-desc">${conteudoFinal}</div>
                        </div>
                    `;
                    card.onclick = () => card.classList.toggle('aberto');
                    container.appendChild(card);
                }
            } catch (e) {
                container.innerHTML = `<div class="error-msg">${e.message}</div>`;
            }
        }

        init();
    </script>
</body>
</html>
